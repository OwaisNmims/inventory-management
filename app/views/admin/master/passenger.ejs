<%- include ('../partials/head') %>

    <!--  BEGIN NAVBAR  -->
    <%- include ('../partials/header') %>
        <!--  END NAVBAR  -->

        <!--  BEGIN MAIN CONTAINER  -->
        <div class="main-container" id="container">

            <div class="overlay"></div>
            <div class="search-overlay"></div>

            <!--  BEGIN SIDEBAR  -->
            <%- include ('../partials/sidebar') %>
                <!--  END SIDEBAR  -->

                <!--  BEGIN CONTENT AREA  -->
                <div id="content" class="main-content">
                    <div class="layout-px-spacing">

                        <div class="middle-content container-xxl p-0">

                            <!--  BEGIN BREADCRUMBS  -->
                            <div class="secondary-nav">
                                <div class="breadcrumbs-container" data-page-heading="Analytics">
                                    <header class="header navbar navbar-expand-sm">
                                        <a href="javascript:void(0);" class="btn-toggle sidebarCollapse"
                                            data-placement="bottom">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                                stroke-linecap="round" stroke-linejoin="round"
                                                class="feather feather-menu">
                                                <line x1="3" y1="12" x2="21" y2="12"></line>
                                                <line x1="3" y1="6" x2="21" y2="6"></line>
                                                <line x1="3" y1="18" x2="21" y2="18"></line>
                                            </svg>
                                        </a>
                                        <div class="d-flex breadcrumb-content">
                                            <div class="page-header">

                                                <div class="page-title">
                                                </div>

                                                <nav class="breadcrumb-style-one" aria-label="breadcrumb">
                                                    <ol class="breadcrumb">
                                                        <li class="breadcrumb-item active"><a
                                                                href="./masters">Master</a></li>
                                                        <li class="breadcrumb-item active" aria-current="page">Passenger
                                                        </li>
                                                    </ol>
                                                </nav>

                                            </div>
                                        </div>

                                    </header>
                                </div>
                            </div>
                            <!--  END BREADCRUMBS  -->

                            <div class="main-content">

                                <div class="table-template">
                                    <div class="table-header">
                                        <div class="table-title">
                                            <h3>Passenger</h3>
                                        </div>
                                        <div class="table-actions">
                                            <button style="background: none; border: none;" data-bs-toggle="modal"
                                                data-bs-target="#add-modal"><i class="fa-regular fa-square-plus"></i>
                                            </button>
                                        </div>
                                    </div>

                                    <div class="table-content">
                                        <div class="table-filter-container"></div>
                                        <div class="table-content">

                                            <div class="table-responsive">
                                                <table class="table table-bordered" id="table-content">
                                                    <thead>
                                                        <tr>
                                                            <th scope="col">Sr No.</th>
                                                            <th scope="col">Passanger Type</th>
                                                            <th class="text-center" scope="col"> Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <% passengerList.forEach((item, idx)=> { %>
                                                            <tr>
                                                                <td><%- ++idx %></td>
                                                                <td class="name"><%- item.name %></td>
                                                                <td>
                                                                    <i data-id="<%- item.id %>"
                                                                        class="fa-regular fa-pen-to-square cursor-pointer btn-edit"></i>
                                                                    <i data-id="<%- item.id %>"
                                                                        class="fa-regular fa-trash-can text-danger btn-delete cursor-pointer"></i>
                                                                </td>
                                                            </tr>
                                                            <% }) %>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                </div>
                <!--  END CONTENT AREA  -->

        </div>
        <!-- END MAIN CONTAINER -->


        <!--ADD Modal -->
        <div class="modal fade" id="add-modal" tabindex="-1" role="dialog" aria-labelledby="add-modal"
            aria-hidden="true">
            <div class="modal-dialog modal-xl" role="document">
                <div class="modal-content modal-inputform">
                    <div class="modal-header  modal-inputform-header">
                        <h5 class="modal-title text-dark" id="">ADD PASSENGER TYPE</h5>
                        <button type="button" class="btn fs-4 text-dark" data-bs-dismiss="modal" aria-label="Close"><i
                                class="fas fa-times"></i></button>

                    </div>
                    <div class="modal-body">
                        <div class="row info-container">
                            <div class="col-md-3 select-fields">

                                <div class="mb-3">
                                    <label class="form-label" for="add-item-input">Add Pax Type</label>
                                    <input type="text" class="form-control" id="add-item-input"
                                        placeholder="Type here..." />
                                </div>

                                <div class="mb-3 d-grid gap-2">
                                    <button class="btn text-light add-item-btn btn-info">ADD</button>
                                </div>

                            </div>
                            <div class="col-md-9 selected-fields">
                                <div class="table-responsive">
                                    <table class="table table-bordered" id="new-item-table">
                                        <thead>
                                            <th>Sr No.</th>
                                            <th>Passenger Type</th>
                                            <th>Action</th>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn create-btn btn-primary">CREATE</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Modal -->
        <div class="modal fade" id="edit-modal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false"
            aria-labelledby="edit-country-modal" aria-hidden="true">
            <div class="modal-dialog modal-sm" role="document">
                <div class="modal-content modal-inputform">
                    <div class="modal-header modal-inputform-header">
                        <h5 class="modal-title text-dark" id="">EDIT ITEM</h5>
                        <button type="button" class="btn fs-4 text-dark" data-bs-dismiss="modal" aria-label="Close">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="select-fields">
                            <div class="mb-3">
                                <label class="form-label" for="edit-item-input">Name</label>
                                <input type="text" class="form-control" id="edit-item-input" />
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" id="save-edited-data" class="btn btn-primary">
                            SAVE
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <%- include ('../partials/footer') %>

            <!-- CUSTOM JS SCRIPT -->
            <script>
                $(document).ready(function () {

                    // GLOBAL VARIABLES
                    let itemLid;
                    let newItemArr = [];

                    //APPEND IN TABLE
                    $('#add-modal .add-item-btn').on('click', function () {
                        const paxType = $('#add-item-input').val();

                        if (!isAlphabetWords(paxType)) {
                            createAlert({
                                title: 'Incorrect input!',
                                msg: 'Only alphabets and spaces are allowed.',
                                type: 'negative',
                            });

                            return false;
                        }

                        // Check for duplicate before pushing
                        const isDuplicate = newItemArr.some(pax => (
                            pax.paxType === paxType
                        ));

                        if (isDuplicate) {
                            createAlert({
                                title: "Duplicate Data!",
                                msg: "Duplicate entries detected.",
                                type: "negative",
                            });
                            return false;
                        }

                        newItemArr.push({ paxType });

                        const newTr = $('<tr>');
                        let rowCount = $('#new-item-table tbody tr').length + 1;

                        newTr.data('data-pax-type', paxType);

                        newTr.append($('<td>').text(rowCount));
                        newTr.append($('<td>').text(paxType));
                        newTr.append($('<td>').html(`<i class="fa-regular fa-trash-can delete-row-btn cursor-pointer"></i>`));

                        $('#new-item-table tbody').append(newTr);
                    })

                    //DELETE TR ROW
                    $(document).on('click', '.delete-row-btn', function () {
                        const tr = $(this).closest('tr');
                        const paxType = tr.data('data-pax-type');

                        // Remove row data from the array
                        newItemArr.splice(newItemArr.findIndex(item => (
                            item.paxType === paxType
                        )), 1);

                        tr.remove();
                        updateSerialNumbers('#new-item-table tbody tr');
                    });


                    //PUSH TO DB
                    $('#add-modal .create-btn').on('click', function () {
                        console.log('new expenses>>>> ', newItemArr)

                        if (newItemArr.length <= 0) {
                            createAlert({
                                title: 'Empty Pax Type List!',
                                msg: 'Cannot create empty Pax Type.',
                                type: 'negative',
                            });
                            return;
                        }

                        $.ajax({
                            method: 'POST',
                            url: '/admin/passenger/add',
                            data: {
                                list: newItemArr
                            },
                            success: function (response) {
                                if (response.data.status == 'success') {
                                    alert(response.data.message);
                                    location.reload(true);
                                } else {
                                    createAlert({
                                        title: 'ERROR',
                                        msg: response.data.message,
                                        type: 'negative',
                                    });
                                }
                            },
                            error: function (error) {
                                createAlert({
                                    title: 'ERROR',
                                    msg: 'Something went wrong!',
                                    type: 'negative',
                                });
                            },
                        });
                    })


                    // EDIT EXPENSE 
                    $(document).on('click', '.btn-edit', function () {
                        itemLid = $(this).attr('data-id');
                        const thisTr = this.closest('tr');
                        const itemName = $(thisTr).find('.name').text();

                        $('#edit-item-input').val(itemName);
                        $('#edit-modal').modal('show');
                    })

                    // Save Edited Expense
                    $(document).on('click', '#save-edited-data', function () {
                        let itemName = $('#edit-item-input').val();

                        $.ajax({
                            method: 'POST',
                            url: '/admin/passenger/update',
                            data: {
                                data: { itemName, itemLid }
                            },
                            success: function (response) {
                                if (response.status == 'success') {
                                    alert(response.message);
                                    location.reload(true);
                                } else {
                                    createAlert({
                                        title: 'ERROR',
                                        msg: response.message,
                                        type: 'negative',
                                    });
                                }
                            },
                            error: function (error) {
                                createAlert({
                                    title: 'ERROR',
                                    msg: 'Something went wrong.',
                                    type: 'negative',
                                });
                            },
                        });
                    })

                    // DELETE EXPENSE
                    $(document).on('click', '.btn-delete', function () {
                        itemLid = $(this).attr('data-id');

                        const isConfirmed = confirm('Are you sure you want to remove the pax type?');

                        if (!isConfirmed) {
                            return false;
                        }

                        $.ajax({
                            method: 'POST',
                            url: '/admin/passenger/delete',
                            data: {
                                data: { itemLid }
                            },
                            success: function (response) {
                                if (response.status == 'success') {
                                    alert(response.message);
                                    location.reload(true);
                                } else {
                                    createAlert({
                                        title: 'ERROR',
                                        msg: response.message,
                                        type: 'negative',
                                    });
                                }
                            },
                            error: function (error) {
                                createAlert({
                                    title: 'ERROR',
                                    msg: 'Something went worng!',
                                    type: 'negative',
                                });
                            },
                        });
                    });

                })
            </script>
            <!--END CUSTOM JS SCRIPT -->


            <%- include ('../partials/footer-end') %>